<% content_for :title, "Dashboard" %>

<div class="space-y-4">
  <%= render(CardComponent.new(
    title: "The Relay API is in beta!",
    color: :amber
  )) do %>
    <p class="text-gray-600">The API might have issues, bugs, and imperfections. We welcome any feedback in our official Helium Discord channel.</p>
  <% end %>

  <%= render(CardComponent.new(title: "Getting Started")) do %>
    <p class="text-gray-600 mb-6">Welcome to the Relay GraphQL API for Helium Oracle data! This API allows you to easily query information about any Helium hotspot, including essential details, earnings, and historical data.</p>

    <div class="flex gap-4">
      <%= render(ButtonComponent.new(
        text: "Read Docs",
        style: :secondary,
        href: "https://docs.relaywireless.com",
        target: "_blank"
      )) %>
      <%= render(ButtonComponent.new(
        text: "Join Relay Discord",
        style: :secondary,
        href: "https://discord.com/channels/404106811252408320/1368978610907513042",
        target: "_blank"
      )) %>
    </div>
  <% end %>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <%= render(CardComponent.new(title: "API Key")) do %>
      <p class="text-gray-600 mb-4">This is your API key for accessing the Relay API.</p>
      <%= render(CopiableTextComponent.new(text: current_user.api_key)) %>
    <% end %>

    <%= render(CardComponent.new(title: "Usage")) do %>
      <%= render(PlanUsageComponent.new(user: current_user)) %>
    <% end %>
  </div>

  <% if current_user.feature_gater.enabled?(:billing) %>
    <div class="space-y-4">
      <div class="text-2xl font-bold">Billing</div>

      <%= render FlashMessageComponent.new(type: :info) do %>
        If you need to change your payment method or access your invoices, you can do it through the <%= link_to "billing portal", billing_portal_path, class: "underline hover:no-underline" %>.
      <% end %>

      <% if current_user.subscription_pending_cancellation? %>
        <%= render FlashMessageComponent.new(type: :alert) do %>
          Your subscription has been canceled. You will continue to have access to your plan until the end of your billing cycle on 
          <%= current_user.payment_processor.subscription.current_period_end.to_date.strftime("%B %d, %Y") %>.
        <% end %>
      <% end %>    
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <% Relay::Billing::Plan.all.select(&:visible).each do |plan| %>
          <div class="flex-shrink-0">
            <%= render(PlanComponent.new(plan: plan, current_user: current_user)) %>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
</div>
